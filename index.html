<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dayita AI – Intelligent Product Catalogue Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10a37f;
            --primary-dark: #0d8a6a;
            --secondary: #343541;
            --secondary-light: #40414f;
            --secondary-lighter: #4a4b5a;
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --user-msg: #9cdcfe;
            --bot-msg: #dcdcaa;
            --accent: #6366f1;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.2s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--secondary);
            color: var(--text-primary);
            line-height: 1.5;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: var(--secondary-light);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .stats {
            display: flex;
            gap: 1.5rem;
            font-size: 0.85rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.7rem;
        }

        /* Main Container */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--secondary-light);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .search-history h3, .quick-queries h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .history-list, .queries-list {
            list-style: none;
            margin-bottom: 2rem;
        }

        .history-item, .query-item {
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            border-left: 3px solid transparent;
        }

        .history-item:hover, .query-item:hover {
            background: rgba(255, 255, 255, 0.07);
            border-left-color: var(--primary);
        }

        .query-item {
            border-left-color: var(--accent);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .welcome-message {
            background: linear-gradient(135deg, var(--secondary-light), var(--secondary-lighter));
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
        }

        .welcome-message h2 {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .welcome-message p {
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .feature {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature i {
            color: var(--primary);
        }

        /* Messages */
        .msg {
            display: flex;
            gap: 1rem;
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-msg {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .bot-msg {
            align-self: flex-start;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-weight: 600;
        }

        .user-msg .avatar {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .bot-msg .avatar {
            background: linear-gradient(135deg, var(--accent), #7c3aed);
        }

        .message-content {
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            max-width: 100%;
            word-wrap: break-word;
        }

        .user-msg .message-content {
            background: var(--secondary-light);
            border-top-right-radius: 4px;
            color: var(--user-msg);
        }

        .bot-msg .message-content {
            background: var(--secondary-light);
            border-top-left-radius: 4px;
            color: var(--bot-msg);
        }

        .product-result {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin-top: 0.75rem;
            border-left: 3px solid var(--primary);
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .product-content {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        .product-details {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .product-details span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .highlight {
            background-color: rgba(16, 163, 127, 0.2);
            padding: 0 2px;
            border-radius: 2px;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 1rem;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Input Area */
        .input-area {
            background: var(--secondary-light);
            padding: 1.25rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            font-size: 0.95rem;
            background: var(--secondary);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.2);
        }

        .input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        button {
            padding: 0.875rem 1.5rem;
            background: var(--primary);
            border: none;
            color: white;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .secondary-btn {
            background: var(--secondary-lighter);
        }

        .secondary-btn:hover {
            background: var(--secondary-lighter);
            filter: brightness(1.1);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary-lighter);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .stats {
                display: none;
            }
            
            .msg {
                max-width: 95%;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .action-buttons button span {
                display: none;
            }
            
            .action-buttons button i {
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="logo">D</div>
            <div class="logo-text">
                <h1>Dayita AI</h1>
                <p>Catalogue Brain – Intelligent Product Assistant</p>
            </div>
        </div>
        <div class="stats">
            <div class="stat-item">
                <span class="stat-value" id="product-count">0</span>
                <span class="stat-label">Products</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="query-count">0</span>
                <span class="stat-label">Queries Today</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="response-time">0.2s</span>
                <span class="stat-label">Avg. Response</span>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <div class="search-history">
                <h3><i class="fas fa-history"></i> Recent Searches</h3>
                <ul class="history-list" id="history-list">
                    <!-- Will be populated dynamically -->
                </ul>
            </div>
            <div class="quick-queries">
                <h3><i class="fas fa-bolt"></i> Quick Queries</h3>
                <ul class="queries-list" id="queries-list">
                    <li class="query-item">Find welding electrodes</li>
                    <li class="query-item">Search by AWS code</li>
                    <li class="query-item">Products on page 100</li>
                    <li class="query-item">CNM(SPLM 2 details</li>
                </ul>
            </div>
            <div class="search-history">
                <h3><i class="fas fa-filter"></i> Filter By</h3>
                <ul class="history-list" id="filter-list">
                    <li class="history-item">AWS Certified</li>
                    <li class="history-item">Page Range</li>
                    <li class="history-item">Electrodes</li>
                    <li class="history-item">Weld Metal</li>
                </ul>
            </div>
        </aside>

        <main class="chat-container">
            <div class="chat" id="chat">
                <div class="welcome-message">
                    <h2><i class="fas fa-brain"></i> Welcome to Dayita AI Catalogue Brain</h2>
                    <p>I'm your intelligent product assistant. I can help you find products, AWS codes, materials, and more from our extensive welding catalogue. Try asking me anything about our products!</p>
                    <div class="features">
                        <div class="feature"><i class="fas fa-search"></i> Smart product search</div>
                        <div class="feature"><i class="fab fa-aws"></i> AWS code lookup</div>
                        <div class="feature"><i class="fas fa-fire"></i> Welding electrodes</div>
                        <div class="feature"><i class="fas fa-file-alt"></i> Page reference finder</div>
                    </div>
                </div>
                
                <!-- Example conversation -->
                <div class="msg bot-msg">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        Hello! I'm ready to help you navigate our welding product catalogue. You can ask me about product names, AWS codes, welding specifications, or search by page reference. What would you like to find?
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <i class="fas fa-search input-icon"></i>
                    <input type="text" id="query-input" placeholder="Ask about welding electrodes, AWS codes, product specifications..." autocomplete="off" autofocus>
                </div>
                <div class="action-buttons">
                    <button class="secondary-btn" id="clear-chat" title="Clear Chat">
                        <i class="fas fa-eraser"></i> <span>Clear</span>
                    </button>
                    <button id="ask-button">
                        <i class="fas fa-paper-plane"></i> <span>Ask Dayita AI</span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // State management
        const state = {
            products: [],
            queryCount: 0,
            searchHistory: JSON.parse(localStorage.getItem('searchHistory')) || [],
            isTyping: false
        };

        // DOM Elements
        const chatEl = document.getElementById('chat');
        const queryInput = document.getElementById('query-input');
        const askButton = document.getElementById('ask-button');
        const clearChatButton = document.getElementById('clear-chat');
        const productCountEl = document.getElementById('product-count');
        const queryCountEl = document.getElementById('query-count');
        const historyListEl = document.getElementById('history-list');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load product data
            loadProducts();
            
            // Set up event listeners
            queryInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') askQuestion();
            });
            
            askButton.addEventListener('click', askQuestion);
            clearChatButton.addEventListener('click', clearChat);
            
            // Set up quick query buttons
            document.querySelectorAll('.query-item, .history-item, .feature').forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('feature')) {
                        const text = this.textContent.replace('Search by page number', 'Search by page').replace('AWS code lookup', 'Find AWS codes');
                        queryInput.value = text;
                    } else {
                        queryInput.value = this.textContent;
                    }
                    queryInput.focus();
                });
            });
            
            // Update stats
            updateStats();
            updateSearchHistoryUI();
        });

        // Load products from JSON
        async function loadProducts() {
            try {
                // Load the products_ai.json file
                const response = await fetch('products_ai.json');
                if (!response.ok) {
                    throw new Error('Failed to load product data');
                }
                state.products = await response.json();
                productCountEl.textContent = state.products.length;
                console.log(`Loaded ${state.products.length} products`);
                
                // Update query count from localStorage
                state.queryCount = parseInt(localStorage.getItem('queryCount')) || 0;
                queryCountEl.textContent = state.queryCount;
            } catch (error) {
                console.error('Error loading products:', error);
                // Fallback to sample data
                state.products = getSampleProducts();
                productCountEl.textContent = state.products.length;
                addMessage('Note: Using sample data. To use full catalogue, ensure products_ai.json is in the same directory.', 'bot');
            }
        }

        // Sample product data as fallback
        function getSampleProducts() {
            return [
                {
                    "product_name": "CNM(SPLM 2",
                    "page": "page_100.txt",
                    "content": "CNM(SPLM 2\nComplete Welding Support\nCodification \nAWS SFA 5.5  12018M\nEN ISO 18275-B E 83 18 N4C2M2 A H5\nCharacteristics & Applications \nBasic coated electrode with a stable and smooth arc easy to strike and restrike.\nLow spatter and good bead finish. Welds are of radiographic quality. The weld metal\ndisplays good crack resistance and produces sound weld metal possessing excellent\nstrength combined with good impact properties at subzero temperature. It is suitable for\njoining many high strength low alloy or micro alloyed steels to themselves or to lower\nstrength steels including carbon steels. Ideally suited for welding earth moving\nequipments and other heavy equipments."
                },
                {
                    "product_name": "EN ISO 2560-A",
                    "page": "page_101.txt",
                    "content": "COROTHERME(SPL)\nComplete Welding Support\nCodification \nAWS SFA 5.5  E7018-W\nEN ISO 2560-A\nCharacteristics & Applications \nCorotherme(SPL) is a special electrode depositing a 0.5%Cr - 0.7%Ni - 0.5%Cu weld metal\nideally suited for welding weathering steels to resist high temperature atmospheric\ncorrosion. Ideal for welding steels like Corten steels used in chemical petrochemical and\nrailway industries to resist atmospheric corrosion."
                },
                {
                    "product_name": "EN ISO 2560-A R424 B92",
                    "page": "page_102.txt",
                    "content": "SUPRATHERME(SPL)\nComplete Welding Support\nCodification \nEN ISO 2560-A R424 B92\nCharacteristics & Applications \nAn iron powder low hydrogen type electrode producing a tough and ductile weld metal for\nwelding heavy and rigid structures subjected to dynamic loading and impact. The weld\nmetal is of radiographic quality and displays remarkable impact strength even at -50C\nTypical applications include welding of carbon steels, steels sensitive to hydrogen\nembrittlement, heavy and rigid structures, pressure vessels and equipment subjected to\nsevere stress and requiring good toughness properties at sub-zero temperatures down to -\n50C"
                },
                {
                    "product_name": "EB5626H1X",
                    "page": "page_103.txt",
                    "content": "SUPRATHERME(SPL)H4R\nComplete Welding Support\nCodification \nAWS SFA 5.1  E7018-1 H4R\nEN ISO 2560-A E424632 H5\nCharacteristics & Applications \nSupratherme(SPL)H4R is a moisture resistant hydrogen controlled basic coated electrode\nfor producing tough and ductile weld of radiographic quality in boilers, pressure vessels,\nmedium carbon steels, cast steel and problematic steels. The weld metal is clean and has\nlow level of impurities thus having unique properties. Some typical applications include\nmaintenance welding of all types of C-Mn steels, heavy tensile steels, heavy structures,\nplants & equipments subjected to static or dynamic loading."
                }
            ];
        }

        // Ask question function
        function askQuestion() {
            const question = queryInput.value.trim();
            if (!question) return;
            
            // Add user message
            addMessage(question, 'user');
            
            // Clear input
            queryInput.value = '';
            
            // Update query count
            state.queryCount++;
            queryCountEl.textContent = state.queryCount;
            localStorage.setItem('queryCount', state.queryCount);
            
            // Add to search history
            if (!state.searchHistory.includes(question)) {
                state.searchHistory.unshift(question);
                if (state.searchHistory.length > 10) state.searchHistory.pop();
                localStorage.setItem('searchHistory', JSON.stringify(state.searchHistory));
                updateSearchHistoryUI();
            }
            
            // Show typing indicator
            showTypingIndicator();
            
            // Process query
            setTimeout(() => {
                removeTypingIndicator();
                const response = processQuery(question);
                addMessage(response.text, 'bot', response.products);
            }, 500 + Math.random() * 500);
        }

        // Process user query
        function processQuery(query) {
            const queryLower = query.toLowerCase();
            
            if (state.products.length === 0) {
                return {
                    text: "I'm still loading the product catalogue. Please try again in a moment.",
                    products: []
                };
            }
            
            // Check for greetings
            if (queryLower.match(/\b(hi|hello|hey|greetings)\b/)) {
                return {
                    text: "Hello! I'm Dayita AI, your welding catalogue assistant. How can I help you find products today?",
                    products: []
                };
            }
            
            // Check for page search
            const pageMatch = query.match(/\bpage\s+(\d+)\b/i) || query.match(/\bpage[_-]?(\d+)\b/i);
            if (pageMatch) {
                const pageNum = pageMatch[1];
                return searchByPage(pageNum);
            }
            
            // Check for AWS code search
            if (queryLower.includes('aws') || queryLower.includes('code')) {
                return searchByAWS(query);
            }
            
            // General search
            return searchProducts(query);
        }

        // Search by page number
        function searchByPage(pageNum) {
            const matchedProducts = state.products.filter(product => {
                const productPage = product.page.match(/\d+/);
                return productPage && productPage[0] === pageNum;
            });
            
            if (matchedProducts.length === 0) {
                return {
                    text: `I couldn't find any products on page ${pageNum}. Try searching for a different page or use general search terms.`,
                    products: []
                };
            }
            
            let responseText = `Found ${matchedProducts.length} product(s) on page ${pageNum}:\n\n`;
            matchedProducts.forEach(product => {
                const productPage = product.page.match(/\d+/);
                responseText += `**${product.product_name || 'Unnamed Product'}** (Page ${productPage ? productPage[0] : 'N/A'})\n`;
                if (product.content) {
                    const preview = product.content.substring(0, 150) + '...';
                    responseText += `*${preview}*\n\n`;
                }
            });
            
            return {
                text: responseText,
                products: matchedProducts
            };
        }

        // Search by AWS code
        function searchByAWS(query) {
            const awsPattern = /\bAWS\s+(?:SFA\s+)?[0-9\.]+\b/i;
            const awsMatch = query.match(awsPattern);
            
            let searchTerm = query;
            if (awsMatch) {
                searchTerm = awsMatch[0];
            }
            
            const matchedProducts = state.products.filter(product => {
                const content = product.content || '';
                return content.toLowerCase().includes(searchTerm.toLowerCase()) ||
                       (product.product_name && product.product_name.toLowerCase().includes(searchTerm.toLowerCase()));
            });
            
            if (matchedProducts.length === 0) {
                return {
                    text: `No products found matching AWS code "${searchTerm}". Try searching with a different AWS code or product name.`,
                    products: []
                };
            }
            
            let responseText = `Found ${matchedProducts.length} product(s) related to AWS codes:\n\n`;
            matchedProducts.forEach(product => {
                responseText += `**${product.product_name || 'Unnamed Product'}**\n`;
                // Extract AWS code from content if present
                const awsInContent = product.content.match(/\bAWS\s+(?:SFA\s+)?[0-9\.\-]+\b/i);
                if (awsInContent) {
                    responseText += `AWS Code: ${awsInContent[0]}\n`;
                }
                responseText += '\n';
            });
            
            return {
                text: responseText,
                products: matchedProducts
            };
        }

        // General product search
        function searchProducts(query) {
            const searchTerms = query.toLowerCase().split(' ');
            
            const matchedProducts = state.products.filter(product => {
                const content = (product.content || '').toLowerCase();
                const productName = (product.product_name || '').toLowerCase();
                
                // Check if any search term matches
                return searchTerms.some(term => {
                    return content.includes(term) || 
                           productName.includes(term) ||
                           (product.page && product.page.toLowerCase().includes(term));
                });
            });
            
            if (matchedProducts.length === 0) {
                return {
                    text: `I couldn't find any products matching "${query}". Try searching with different keywords like:\n- Product names (e.g., "CNM(SPLM 2")\n- AWS codes\n- Page numbers\n- Welding terms`,
                    products: []
                };
            }
            
            let responseText = `Found ${matchedProducts.length} product(s) related to "${query}":\n\n`;
            
            // Limit to top 3 results for readability
            const displayProducts = matchedProducts.slice(0, 3);
            
            displayProducts.forEach((product, index) => {
                const pageNum = product.page.match(/\d+/);
                responseText += `**${index + 1}. ${product.product_name || 'Unnamed Product'}**\n`;
                if (pageNum) {
                    responseText += `Page: ${pageNum[0]}\n`;
                }
                
                // Show preview of content
                if (product.content) {
                    const preview = product.content.substring(0, 200).split('\n')[0];
                    responseText += `${preview}...\n\n`;
                }
            });
            
            if (matchedProducts.length > 3) {
                responseText += `... and ${matchedProducts.length - 3} more products. Refine your search for more specific results.`;
            }
            
            return {
                text: responseText,
                products: matchedProducts
            };
        }

        // Add message to chat
        function addMessage(text, sender, products = []) {
            removeTypingIndicator();
            
            const messageEl = document.createElement('div');
            messageEl.className = `msg ${sender}-msg`;
            
            const avatarEl = document.createElement('div');
            avatarEl.className = 'avatar';
            avatarEl.textContent = sender === 'user' ? 'You' : 'AI';
            
            const contentEl = document.createElement('div');
            contentEl.className = 'message-content';
            
            // Format text with line breaks and bold markers
            let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            
            // Highlight search terms in content
            if (sender === 'bot' && products.length > 0) {
                const lastQuery = state.searchHistory[0] || '';
                if (lastQuery) {
                    const terms = lastQuery.toLowerCase().split(' ').filter(term => term.length > 2);
                    terms.forEach(term => {
                        const regex = new RegExp(`(${term})`, 'gi');
                        formattedText = formattedText.replace(regex, '<span class="highlight">$1</span>');
                    });
                }
            }
            
            contentEl.innerHTML = formattedText;
            
            // Add product details if available
            if (products.length > 0 && sender === 'bot') {
                // Add first product as detailed example
                const product = products[0];
                if (product.content) {
                    const productEl = document.createElement('div');
                    productEl.className = 'product-result';
                    
                    const pageNum = product.page.match(/\d+/);
                    let detailsHTML = '';
                    
                    if (product.product_name) {
                        detailsHTML += `<div class="product-name">${product.product_name}</div>`;
                    }
                    
                    // Show first 300 characters of content
                    const contentPreview = product.content.substring(0, 300) + (product.content.length > 300 ? '...' : '');
                    detailsHTML += `<div class="product-content">${contentPreview}</div>`;
                    
                    detailsHTML += `<div class="product-details">`;
                    if (pageNum) {
                        detailsHTML += `<span><i class="fas fa-file-alt"></i> Page ${pageNum[0]}</span>`;
                    }
                    
                    // Extract AWS code if present
                    const awsMatch = product.content.match(/\bAWS\s+(?:SFA\s+)?[0-9\.\-]+\b/i);
                    if (awsMatch) {
                        detailsHTML += `<span><i class="fab fa-aws"></i> ${awsMatch[0]}</span>`;
                    }
                    
                    // Check for welding terms
                    if (product.content.toLowerCase().includes('electrod')) {
                        detailsHTML += `<span><i class="fas fa-fire"></i> Electrode</span>`;
                    }
                    
                    detailsHTML += `</div>`;
                    
                    productEl.innerHTML = detailsHTML;
                    contentEl.appendChild(productEl);
                }
            }
            
            messageEl.appendChild(avatarEl);
            messageEl.appendChild(contentEl);
            chatEl.appendChild(messageEl);
            
            // Scroll to bottom
            chatEl.scrollTop = chatEl.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            if (state.isTyping) return;
            state.isTyping = true;
            
            const typingEl = document.createElement('div');
            typingEl.className = 'msg bot-msg';
            typingEl.id = 'typing-indicator';
            
            const avatarEl = document.createElement('div');
            avatarEl.className = 'avatar';
            avatarEl.textContent = 'AI';
            
            const contentEl = document.createElement('div');
            contentEl.className = 'typing-indicator';
            contentEl.innerHTML = '<span></span><span></span><span></span>';
            
            typingEl.appendChild(avatarEl);
            typingEl.appendChild(contentEl);
            chatEl.appendChild(typingEl);
            chatEl.scrollTop = chatEl.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            state.isTyping = false;
            const typingEl = document.getElementById('typing-indicator');
            if (typingEl) typingEl.remove();
        }

        // Clear chat
        function clearChat() {
            const messages = chatEl.querySelectorAll('.msg');
            for (let i = 0; i < messages.length; i++) {
                if (i > 1) {
                    messages[i].remove();
                }
            }
            addMessage("Chat history cleared. How can I help you with our welding product catalogue?", 'bot');
        }

        // Update search history UI
        function updateSearchHistoryUI() {
            historyListEl.innerHTML = '';
            state.searchHistory.forEach(query => {
                const li = document.createElement('li');
                li.className = 'history-item';
                li.textContent = query.length > 30 ? query.substring(0, 30) + '...' : query;
                li.title = query;
                li.addEventListener('click', () => {
                    queryInput.value = query;
                    queryInput.focus();
                });
                historyListEl.appendChild(li);
            });
            
            // Add default if empty
            if (state.searchHistory.length === 0) {
                const defaultItems = [
                    "Find welding electrodes",
                    "Search by AWS code",
                    "Products on page 100",
                    "Welding specifications"
                ];
                
                defaultItems.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'history-item';
                    li.textContent = item;
                    li.addEventListener('click', () => {
                        queryInput.value = item;
                        queryInput.focus();
                    });
                    historyListEl.appendChild(li);
                });
            }
        }

        // Update statistics
        function updateStats() {
            // Update response time with random value for demo
            const responseTimeEl = document.getElementById('response-time');
            setInterval(() => {
                const time = (0.1 + Math.random() * 0.3).toFixed(1);
                responseTimeEl.textContent = `${time}s`;
            }, 3000);
        }
    </script>
</body>
</html>